<div class="nested0" aria-labelledby="ariaid-title1" topicindex="1" topicid="mte1507833902686" id="mte1507833902686"><h1 class="title topictitle1" id="ariaid-title1">OutlierFilter (ML Engine)</h1><div class="body conbody">
<p class="p">The OutlierFilter function is useful for filtering a numeric data set before applying <span><b>ML Engine</b></span> functions for which outliers can skew the estimates of parameters and cause inaccurate predictions. Such functions include time series functions, GLM, LAR, LinReg, PCA, and KMeans. The input data set is expected to have millions of attribute-value pairs.</p><div class="p">The OutlierFilter function filters outliers from a data set, either deleting them or replacing them with a specified value. Optionally, the function stores the outliers in their own table. The function provides these methods for filtering outliers:
<ul class="ul" id="mte1507833902686__ul_kbg_dqq_yx">
<li class="li">Percentile</li>
<li class="li">Tukey's test</li>
<li class="li">Carling's modification to Tukey's test</li>
<li class="li">Median absolute deviation</li></ul></div>
<p class="p">The method determines the criteria for an observation to classify as an outlier.</p></div><div class="topic reference nested1" aria-labelledby="ariaid-title2" topicindex="2" topicid="vxm1507833934995" xml:lang="en-us" lang="en-us" id="vxm1507833934995">
<h2 class="title topictitle2" id="ariaid-title2">OutlierFilter Syntax</h2><div class="body refbody"><div class="section" id="vxm1507833934995__section_N1000E_N1000C_N10001">
<h3 class="title sectiontitle">Version <span>1.10</span></h3><pre class="pre codeblock" xml:space="preserve"><code>SELECT * FROM OutlierFilter (
  <span>ON { <var class="keyword varname">table</var> | <var class="keyword varname">view</var> | (<var class="keyword varname">query</var>) }</span> AS InputTable
  OUT TABLE OutputTable (<var class="keyword varname">output_table</var>)
  [ OUT TABLE OutliersTable (<var class="keyword varname">outliers_table</var>) ]
  USING
  TargetColumns ('<var class="keyword varname">target_column</var>' [,...])
  [ GroupByColumns ('<var class="keyword varname">group_column</var>' [,...]) ]
  [ OutlierMethod ('<var class="keyword varname">method</var>' [,...]) ]
  [ ApproxPercentile (<span><b>{'true'|'t'|'yes'|'y'|'1'|'false'|'f'|'no'|'n'|'0'}</b></span>) ]
  [ PercentileThreshold (<var class="keyword varname">perc_lower</var>, <var class="keyword varname">perc_upper</var>]) ]
  [ PercentAccuracy (<var class="keyword varname">accuracy</var>) ]
  [ IQRMultiplier (<var class="keyword varname">k</var>) ]
  [ RemoveTail ({ 'both' | 'upper' | 'lower' }) ]
  [ ReplacementValue ({ 'delete' | 'null' | 'median' | '<var class="keyword varname">newval</var>' }) ]
  [ MADScaleConstant (<var class="keyword varname">constant</var>) ]
  [ MADThreshold (<var class="keyword varname">madlimit</var>) ]
) AS <var class="keyword varname">alias</var>;</code></pre></div></div></div><div class="topic reference nested1" aria-labelledby="ariaid-title3" topicindex="3" topicid="kpp1507833939682" xml:lang="en-us" lang="en-us" id="kpp1507833939682">
<h2 class="title topictitle2" id="ariaid-title3">OutlierFilter Syntax Elements</h2><div class="body refbody"><div class="section" id="kpp1507833939682__section_N10011_N1000E_N10001"><dl class="dl parml"><dt class="dt pt dlterm">OutputTable</dt><dd class="dd pd">Specify the name of the table where the function stores the copy of the InputTable (including the PARTITION BY column) with the outliers either deleted (by default) or replaced (as specified by the ReplacementValue syntax element).</dd><dt class="dt pt dlterm">OutliersTable</dt><dd class="dd pd">[Optional] Specify the name of the table where the function outputs copies of the rows of the InputTable that contain outliers.</dd><dd class="dd pd ddexpand">Default behavior: Function does not output an outlier table.</dd><dt class="dt pt dlterm">TargetColumns</dt><dd class="dd pd">Specify the names of the InputTable columns that contain numeric data to filter.</dd><dt class="dt pt dlterm">GroupByColumns</dt><dd class="dd pd">[Optional] Specify the names of the InputTable columns by which to group the data. If the data schema format is <var class="keyword varname">name</var>:<var class="keyword varname">value</var>, this list must include <var class="keyword varname">name</var>.</dd><dd class="dd pd ddexpand">Default behavior: Function does not group data.</dd><dt class="dt pt dlterm">OutlierMethod</dt><dd class="dd pd">[Optional] Specify one or more of the following methods of filtering outliers:
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="kpp1507833939682__table_m2g_nxz_fdb" class="table" frame="border" border="1" rules="all"><div class="caption"></div><colgroup span="1"><col style="width:25%" span="1"></col><col style="width:75%" span="1"></col></colgroup><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:top;" id="d98414e192" rowspan="1" colspan="1"><var class="keyword varname">method</var></th><th class="entry cellrowborder" style="vertical-align:top;" id="d98414e195" rowspan="1" colspan="1">Description</th></tr></thead><tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e192" rowspan="1" colspan="1"><code class="ph codeph">'percentile'</code> (Default)</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e195" rowspan="1" colspan="1">Percentile.</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e192" rowspan="1" colspan="1"><code class="ph codeph">'tukey'</code></td><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e195" rowspan="1" colspan="1">Tukey's test:
<p class="p">An outlier is defined as any observation smaller than V1 - <var class="keyword varname">k</var>*(V3-V1) or larger than V3 + <var class="keyword varname">k</var>*(V3-V1), where V1 and V3 are 25th and 75th percentiles of data and <var class="keyword varname">k</var> is specified by IQRMultiplier syntax element.</p></td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e192" rowspan="1" colspan="1"><code class="ph codeph">'carling'</code></td><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e195" rowspan="1" colspan="1">Carling's modification to Tukey's test:
<p class="p">An outlier is defined as an observation outside the range V2 ± c*(V3 - V1), where V2 is median of data, V1 and V3 are 25th and 75th percentiles of data, and c is constant (which you cannot change).</p>
<p class="p">For more information about Carling's modification, see:</p>
<p class="p"><cite class="cite">Carling, Kenneth. "Resistant outlier rules and the non-Gaussian case." Computational Statistics and Data Analysis 33, no. 3 (2000): 249-258.</cite> Available at <a class="xref" href="https://core.ac.uk/download/pdf/6559387.pdf" target="_blank" title="" shape="rect">https://core.ac.uk/download/pdf/6559387.pdf</a>.</p></td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e192" rowspan="1" colspan="1"><code class="ph codeph">'MAD-median'</code></td><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e195" rowspan="1" colspan="1">Median absolute deviation (MAD), median of absolute values of residuals.
<p class="p"> For example, for <var class="keyword varname">i</var> datapoints and median value of data <var class="keyword varname">M</var>, MAD=median<span><sub><var class="keyword varname">i</var></sub></span>(|x<span><sub><var class="keyword varname">i</var></sub></span>-<var class="keyword varname">M</var> |).</p></td></tr></tbody></table></div>
<p class="p">Specify either one <var class="keyword varname">method</var>, which the function uses for all columns specified by TargetColumns, or specify a <var class="keyword varname">method</var> for each column specified by TargetColumns.</p></dd></dl><dl class="dl parml"><dt class="dt pt dlterm">ApproxPercentile</dt><dd class="dd pd">[Optional] Specify whether the function calculates the percentiles used as filter limits exactly. Approximate percentiles are typically faster, but can fail when the number of groups exceeds one million.</dd><dd class="dd pd ddexpand">Default: 'false'</dd><dt class="dt pt dlterm">PercentileThreshold</dt><dd class="dd pd">[Optional] Specify the range of percentile values for 'percentile' filtering, [<var class="keyword varname">perc_lower</var>, 100 -<var class="keyword varname">perc_lower</var>].</dd><dd class="dd pd ddexpand">Default: [5, 95]</dd><dt class="dt pt dlterm">PercentAccuracy</dt><dd class="dd pd">[Optional] Specify the accuracy of percentiles used for filtering. The value <var class="keyword varname">accuracy</var> must be in the range [0.01, 50].</dd><dd class="dd pd ddexpand">Default: 0.5%</dd><dt class="dt pt dlterm">IQRMultiplier</dt><dd class="dd pd">[Optional] Specify the multiplier of interquartile range for 'tukey' filtering.</dd><dd class="dd pd ddexpand">Default: 1.5</dd><dt class="dt pt dlterm">RemoveTail</dt><dd class="dd pd">[Optional] Specify the side of the distribution to filter.</dd><dd class="dd pd ddexpand">Default: 'both'</dd><dt class="dt pt dlterm">ReplacementValue</dt><dd class="dd pd">[Optional] Specify how the function handles outliers:
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="kpp1507833939682__table_dgf_1zz_fdb" class="table" frame="border" border="1" rules="all"><div class="caption"></div><colgroup span="1"><col style="width:50%" span="1"></col><col style="width:50%" span="1"></col></colgroup><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:top;" id="d98414e329" rowspan="1" colspan="1">Option</th><th class="entry cellrowborder" style="vertical-align:top;" id="d98414e331" rowspan="1" colspan="1">Description</th></tr></thead><tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e329" rowspan="1" colspan="1"><code class="ph codeph">'delete'</code> (Default)</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e331" rowspan="1" colspan="1">Function does not copy row to output table.</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e329" rowspan="1" colspan="1"><code class="ph codeph">'null'</code></td><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e331" rowspan="1" colspan="1">Function copies row to output table, replacing each outlier with value NULL.</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e329" rowspan="1" colspan="1"><code class="ph codeph">'median'</code></td><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e331" rowspan="1" colspan="1">Function copies row to output table, replacing each outlier with median value for its group.</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e329" rowspan="1" colspan="1"><var class="keyword varname">newval</var></td><td class="entry cellrowborder" style="vertical-align:top;" headers="d98414e331" rowspan="1" colspan="1">Function copies row to output table, replacing each outlier with <var class="keyword varname">newval</var>, which must be a numeric value.</td></tr></tbody></table></div></dd><dt class="dt pt dlterm">MadScaleConstant</dt><dd class="dd pd">[Optional] Specify the scale constant used with 'MAD-median' filtering; a DOUBLE PRECISION value.</dd><dd class="dd pd ddexpand">Default: 1.4826, which means MAD = 1.4826 * median(|x - median(x)|)</dd><dt class="dt pt dlterm">MadThreshold</dt><dd class="dd pd">[Optional] Specify the threshold used with 'MAD-median' filtering; a DOUBLE PRECISION value.</dd><dd class="dd pd ddexpand">Default: 3, which means that |x-median(x)|/MAD > 3 is flagged as an outlier</dd></dl></div></div></div></div>
