<div class="nested0" aria-labelledby="ariaid-title1" topicindex="1" topicid="zea1507654518162" id="zea1507654518162"><h1 class="title topictitle1" id="ariaid-title1">Approximate Percentile (ML Engine)</h1><div class="body conbody">
<p class="p">The Approximate Percentile function, composed of ApproxPercentileReduce and ApproxPercentileMap, computes approximate percentiles for one or more columns of data. The <var class="keyword varname">n</var>th percentile is the smallest value in a data set that is greater than <var class="keyword varname">n</var>% of the values. The larger the data set, the more accurate the approximate percentile.</p>
<p class="p">The Approximate Percentile function is based on an algorithm developed by Greenwald and Khanna. The function gives <var class="keyword varname">e</var>-approximate quantile summaries of a set of <var class="keyword varname">N</var> elements, where <var class="keyword varname">e</var> is the error (the desired accuracy of the approximation). Given any rank <var class="keyword varname">r</var>, an <var class="keyword varname">e</var>-approximate summary returns a value whose rank <var class="keyword varname">r'</var> is in the interval [<var class="keyword varname">r</var> - <var class="keyword varname">e</var><span><sup><var class="keyword varname">N</var></sup></span>, <var class="keyword varname">r</var> + <var class="keyword varname">e</var><span><sup><var class="keyword varname">N</var></sup></span>]. The algorithm has a worst-case space requirement of <span>O</span>((1/<var class="keyword varname">e</var>) * log(<var class="keyword varname">e</var><span><sup><var class="keyword varname">N</var></sup></span>)).</p>
<p class="p">When running the Approximate Percentile function, you specify <var class="keyword varname">e</var> with the ErrorRate parameter.</p></div><div class="related-links"><div class="linklistheader"><p></p><b>Related Information</b></div>
<ul class="linklist linklist"><div class="linklistmember"><a href="qym1549987102806.md">Nondeterministic Results and UniqueID Syntax Element</a></div><div class="linklistmember"><a href="zrb1558121575859.md#mjb1507734282027">Percentiles (ML Engine)</a></div></ul></div><div class="topic reference nested1" aria-labelledby="ariaid-title2" topicindex="2" topicid="cgv1507654696218" xml:lang="en-us" lang="en-us" id="cgv1507654696218">
<h2 class="title topictitle2" id="ariaid-title2">Approximate Percentile Syntax</h2><div class="body refbody"><div class="section" id="cgv1507654696218__section_N1000E_N1000C_N10001">
<h3 class="title sectiontitle">ApproxPercentileReduce version <span>1.8</span>, ApproxPercentileMap version <span>1.6</span></h3><pre class="pre codeblock" xml:space="preserve"><code>SELECT * FROM ApproxPercentileReduce (
  ON ([ SELECT * FROM ] ApproxPercentileMap (
    <span>ON { <var class="keyword varname">table</var> | <var class="keyword varname">view</var> | (<var class="keyword varname">query</var>) }</span>
    USING
    TargetColumns ('<var class="keyword varname">target_column</var>' [,...])
    [ ErrorRate (<var class="keyword varname">error</var>) ]
    [ GroupByColumns ('<var class="keyword varname">group_column</var>' [,...]) ]
    ) AS <var class="keyword varname">alias_1</var>
  ) PARTITION BY [ 1 | <var class="keyword varname">group_column</var> [,...]]
  USING
  [ Percentile (<var class="keyword varname">percentile</var> [,...]) ]
  [ TargetColumns ('<var class="keyword varname">target_column</var>' [,...]) ]
  [ GroupByColumns ('<var class="keyword varname">group_column</var>' [,...]) ]
) AS <var class="keyword varname">alias_2</var>;</code></pre></div></div></div><div class="topic reference nested1" aria-labelledby="ariaid-title3" topicindex="3" topicid="pdi1507654711236" xml:lang="en-us" lang="en-us" id="pdi1507654711236">
<h2 class="title topictitle2" id="ariaid-title3">Approximate Percentile Syntax Elements</h2><div class="body refbody"><div class="section" id="pdi1507654711236__section_N10011_N1000E_N10001"><dl class="dl parml"><dt class="dt pt dlterm">TargetColumns</dt><dd class="dd pd">Specify the names of the input columns for which to compute approximate percentiles.
<p class="p">If you specify only one <var class="keyword varname">target_column</var> in the ApproxPercentileMap function, you can omit this syntax element in the ApproxPercentileReduce function.</p>
<p class="p">If you specify more than one <var class="keyword varname">target_column</var> in the ApproxPercentileMap function, you must specify this syntax element in the ApproxPercentileReduce function. In ApproxPercentileReduce, this syntax element must specify at least one <var class="keyword varname">target_column</var> that it specifies in ApproxPercentileMap. Only the target columns specified in ApproxPercentileReduce appear in the output table.</p></dd><dt class="dt pt dlterm">ErrorRate</dt><dd class="dd pd">[Optional] Specify the error (desired accuracy) of the approximation; that the quantile is to be correct within <var class="keyword varname">error</var>%. The <var class="keyword varname">error</var> must be in the range [.01, 50]. Lower error is more accurate but takes longer to compute.</dd><dd class="dd pd ddexpand">Default: 1</dd><dt class="dt pt dlterm">Percentile</dt><dd class="dd pd">[Optional] Specify the approximate percentiles to compute. Each <var class="keyword varname">percentile</var> is an INTEGER.</dd><dd class="dd pd ddexpand">Default behavior: The function computes the percentiles 0, 25, 50, 75, and 100.</dd><dt class="dt pt dlterm">GroupByColumns</dt><dd class="dd pd">[Optional] Specify the names of the input columns by which to group the data. 
<p class="p">If you specify this syntax element, the function computes the approximate percentile for each group in each column. For example, if the target columns are State, Town, and Population, the function computes the approximate percentile for the population of each state.</p>
<p class="p">If you omit this syntax element, the function computes the approximate percentile for the entire column. For example, if the target columns are State, Town, and Population, the function computes the approximate percentile for the population across all towns.</p>
<p class="p">To specify this syntax element, you must do so in both the ApproxPercentileMap and the ApproxPercentileReduce functions, and specify each <var class="keyword varname">group_column</var> in the PARTITION BY clause.</p></dd></dl></div></div></div></div>
