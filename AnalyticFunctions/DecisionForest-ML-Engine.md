<html><head></head><body><div class="nested0" aria-labelledby="ariaid-title1" topicindex="1" topicid="kmu1509310050627" id="kmu1509310050627"><h1 class="title topictitle1" id="ariaid-title1">DecisionForest (ML Engine)</h1><div class="body conbody">
<p class="p">The DecisionForest function uses a training data set to create a predictive model. You can input the model to the <a href="zif1541519521313.md#ohm1507917337702">DecisionForestPredict_MLE (ML Engine)</a> function, which uses it to make predictions.</p>
<p class="p">The size of each individual decision tree output by the DecisionForest function must be less than 32 MB. The factors that affect the size of a decision tree are the depth of the tree, the number of categorical inputs, and the number of numerical inputs. If the size of a decision tree exceeds 32 MB, the function issues an error message. Therefore, control the factors in the input data that increase the size of decision trees.</p>
<p class="p"><span><b>ML Engine</b></span> provides a tree_size_estimator function that you can use to estimate maximum values for the syntax elements TreeSize and NumTrees, based on the cluster configuration and the number of predictor variables. This is the syntax of the tree_size_estimator function:</p><pre class="pre codeblock" xml:space="preserve"><code>SELECT * FROM tree_size_estimator@coprocessor
  (ON <var class="keyword varname">inputtable</var> NumericInputs (<var class="keyword varname">'predictor</var>' [,…]));</code></pre>
<p class="p">The query results includes a row_count column. The average value of this column is the recommended maximum value for the syntax element NumTrees.</p></div><div class="topic reference nested1" aria-labelledby="ariaid-title2" topicindex="2" topicid="vfl1506112431778" xml:lang="en-us" lang="en-us" id="vfl1506112431778">
<h2 class="title topictitle2" id="ariaid-title2">DecisionForest Syntax</h2><div class="body refbody"><div class="section" id="vfl1506112431778__section_N1000E_N1000C_N10001">
<h3 class="title sectiontitle">Version <span>2.25</span></h3><pre class="pre codeblock" xml:space="preserve"><code>SELECT * FROM DecisionForest (
  <span>ON { <var class="keyword varname">table</var> | <var class="keyword varname">view</var> | (<var class="keyword varname">query</var>) }</span> AS InputTable
  OUT TABLE OutputTable (<var class="keyword varname">output_table</var>)
  [ OUT TABLE OutputMessageTable (<var class="keyword varname">output_message_table</var>) ]
  USING
  ResponseColumn ('<var class="keyword varname">response_column</var>')
  [ NumericInputs ('<var class="keyword varname">numeric_input_column</var>' [,...]) ]
  [ CategoricalInputs ('<var class="keyword varname">categorical_input_column</var>' [,...]) ]
  [ CategoricalEncoding ({ 'GrayCode' | 'Hashing' }) ]
  [ MaxNumCategoricalValues (<var class="keyword varname">max_cat_values</var>) ]
  [ TreeType ( { 'regression' | 'classification' } ) ]
  [ NumTrees (<var class="keyword varname">number_of_trees</var>) ]
  [ TreeSize (<var class="keyword varname">tree_size</var>) ]
  [ MinNodeSize (<var class="keyword varname">min_node_size</var>) ]
  [ Variance (<var class="keyword varname">variance</var>) ]
  [ MaxDepth (<var class="keyword varname">max_depth</var>) ]
  [ Mtry (<var class="keyword varname">mtry</var>) ]
  [ MtrySeed (<var class="keyword varname">mtryseed</var>) ]
  [ OutOfBag (<span><b>{'true'|'t'|'yes'|'y'|'1'|'false'|'f'|'no'|'n'|'0'}</b></span>) ]
  [ DisplayNumProcessedRows <span><b>{'true'|'t'|'yes'|'y'|'1'|'false'|'f'|'no'|'n'|'0'}</b></span> ]
  [ Seed (<var class="keyword varname">seed</var>) ]
  <span>[ IDColumn (<var class="keyword varname">id_column</var>) ]</span>
) AS <var class="keyword varname">alias</var>;</code></pre></div></div></div><div class="topic reference nested1" aria-labelledby="ariaid-title3" topicindex="3" topicid="nsi1506112553032" xml:lang="en-us" lang="en-us" id="nsi1506112553032">
<h2 class="title topictitle2" id="ariaid-title3">DecisionForest Syntax Elements</h2><div class="body refbody"><div class="section" id="nsi1506112553032__section_N10011_N1000E_N10001"><dl class="dl parml"><dt class="dt pt dlterm">OutputTable</dt><dd class="dd pd">Specify the name for the model table that the function outputs.</dd><dt class="dt pt dlterm">OutputMessageTable</dt><dd class="dd pd">[Optional] Specify the name for the output message table that the function outputs.</dd><dd class="dd pd ddexpand">Default:  default_dt_monitor_table in the current schema</dd><dt class="dt pt dlterm">ResponseColumn</dt><dd class="dd pd">Specify the name of the InputTable column that contains the response variable (that is, the quantity that you want to predict).</dd><dt class="dt pt dlterm">NumericInputs</dt><dd class="dd pd">[Required if you omit CategoricalInputs.] Specify the names of the InputTable columns to treat as the numeric predictor variables (which must be numeric values).</dd><dt class="dt pt dlterm">CategoricalInputs</dt><dd class="dd pd">[Required if you omit NumericInputs.] Specify the names of the InputTable columns to treat as the categorical predictor variables (which can be either numeric or VARCHAR values).</dd><dd class="dd pd ddexpand">For information about columns that you must identify as numeric or categorical, see <a href="uxa1540574678350.md">Identification of Numeric and Categorical Columns</a>.</dd><dt class="dt pt dlterm">CategoricalEncoding</dt><dd class="dd pd">[Optional with CategoricalInputs, disallowed otherwise.] Specify algorithm for encoding categorical columns:
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="nsi1506112553032__table_n14_5pp_sgb" class="table" frame="border" border="1" rules="all"><div class="caption"></div><colgroup span="1"><col style="width:50%" span="1"></col><col style="width:50%" span="1"></col></colgroup><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:top;" id="d18876e222" rowspan="1" colspan="1">Option</th><th class="entry cellrowborder" style="vertical-align:top;" id="d18876e224" rowspan="1" colspan="1">Description</th></tr></thead><tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d18876e222" rowspan="1" colspan="1">GrayCode</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d18876e224" rowspan="1" colspan="1">Recommended when accuracy is critical. Depending on available memory, out-of-memory errors can occur if a categorical column has more than about 20 unique levels, even with a small data set.</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d18876e222" rowspan="1" colspan="1">Hashing</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d18876e224" rowspan="1" colspan="1">Optimizes calculation speed and minimizes memory use, possibly decreasing accuracy.</td></tr></tbody></table></div></dd><dd class="dd pd ddexpand">Default: 'GrayCode'</dd><dt class="dt pt dlterm">MaxNumCategoricalValues</dt><dd class="dd pd">[Optional] Specify the maximum number of distinct values for a single categorical variable. The <var class="keyword varname">max_cat_values</var> must be a positive INTEGER.</dd><dd class="dd pd ddexpand">With CategoricalEncoding (GrayCode), a <var class="keyword varname">max_cat_values</var> greater than 30 slows computation speed.</dd><dd class="dd pd ddexpand">Default: 20</dd><dt class="dt pt dlterm">TreeType</dt><dd class="dd pd">[Optional] Specify whether the analysis is a regression (continuous response variable) or a multiple-class classification (predicting result from the number of classes).</dd><dd class="dd pd ddexpand">Default: 'regression' if the response variable is numeric, 'classification' otherwise</dd><dt class="dt pt dlterm">NumTrees</dt><dd class="dd pd">[Optional] Specify the number of trees to grow in the forest model. When specified, <var class="keyword varname">number_of_trees</var> must be greater than or equal to the number of vworkers. When not specified, the function builds the minimum number of trees that provides the input data set with full coverage.</dd><dt class="dt pt dlterm">TreeSize</dt><dd class="dd pd">[Optional] Specify the number of rows that each tree uses as its input data set.</dd><dd class="dd pd ddexpand">Default behavior: The function builds a tree using either the number of rows on a vworker or the number of rows that fit into the vworker’s memory, whichever is less.</dd><dt class="dt pt dlterm">MinNodeSize</dt><dd class="dd pd">[Optional] Specify a decision tree stopping criterion; the minimum size of any node within each decision tree.</dd><dd class="dd pd ddexpand">Default: 1</dd><dt class="dt pt dlterm">Variance</dt><dd class="dd pd">[Optional] Specify a decision tree stopping criterion. If the variance within any node dips below this value, the algorithm stops looking for splits in the branch.</dd><dd class="dd pd ddexpand">Default: 0</dd><dt class="dt pt dlterm">MaxDepth</dt><dd class="dd pd">[Optional] Specify a decision tree stopping criterion. If the tree reaches a depth past this value, the algorithm stops looking for splits. Decision trees can grow to (2<span><sup>(<var class="keyword varname">max_depth</var>+1)</sup></span> - 1) nodes. This stopping criteria has the greatest effect on the performance of the function.</dd><dd class="dd pd ddexpand">Default: 12</dd><dt class="dt pt dlterm">Mtry</dt><dd class="dd pd">[Optional] Specify the number of variables to randomly sample from each input value. For example, if <var class="keyword varname">mtry</var> is 3, then the function randomly samples 3 variables from each input at each split. The <var class="keyword varname">mtry</var> must be an INTEGER.</dd><dd class="dd pd ddexpand">Default behavior: The function randomly samples all predictors.<div class="note tip" id="nsi1506112553032__note_N1012B_N10118_N10111_N10018_N10014_N10010_N10001"><span><b>Tip</b></span><div class="notebody"><div class="p">Calculate the initial value for <var class="keyword varname">mtry</var>, where <var class="keyword varname">p</var> is number of variables used for prediction, as follows:
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="nsi1506112553032__table_km2_2pz_fdb" class="table" frame="border" border="1" rules="all"><div class="caption"></div><colgroup span="1"><col style="width:25%" span="1"></col><col style="width:75%" span="1"></col></colgroup><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:top;" id="d18876e332" rowspan="1" colspan="1">Tree Type</th><th class="entry cellrowborder" style="vertical-align:top;" id="d18876e334" rowspan="1" colspan="1"><var class="keyword varname">mtry</var> Initial Value</th></tr></thead><tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d18876e332" rowspan="1" colspan="1">Classification</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d18876e334" rowspan="1" colspan="1"><code class="ph codeph">round(sqrt(<var class="keyword varname">p</var>))</code></td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d18876e332" rowspan="1" colspan="1">Regression</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d18876e334" rowspan="1" colspan="1"><code class="ph codeph">round(<var class="keyword varname">p</var>/3)</code></td></tr></tbody></table></div></div></div></div></dd><dt class="dt pt dlterm">MtrySeed</dt><dd class="dd pd">[Optional] Specify a LONG value to use in determining the random seed for <var class="keyword varname">mtry</var>.</dd><dt class="dt pt dlterm">OutOfBag</dt><dd class="dd pd">[Optional] Specify whether to output the out-of-bag estimate of error rate. </dd><dd class="dd pd ddexpand">The bootstrapping technique provides a convenient method for estimating the test error that does not require cross-validation. When creating a decision forest, each tree is built on a subset of the original data set that is created by sampling with replacement. The points in the original data set that were not used in creating a particular tree are called the <dfn class="term">out-of-bag</dfn> observations for that tree. You can use this set of data points as a test set for this particular tree. By creating such a test set for each tree in the forest, you can estimate the test error of the model.</dd><dd class="dd pd ddexpand">If OutOfBag is 'true', the function calculates the <dfn class="term">out-of-bag error</dfn> for a decision forest model with this procedure: 
<ol class="ol" id="nsi1506112553032__ol_utb_nmd_kz">
<li class="li">For each observation <var class="keyword varname">i</var>, use each tree for which the observation was out-of-bag to predict a response.</li>
<li class="li">Combine the responses to make an out-of-bag prediction for observation <var class="keyword varname">i</var>:
<ul class="ul" id="nsi1506112553032__ul_ykm_wmd_kz">
<li class="li">For classification trees, take the majority vote of the predicted responses.</li>
<li class="li">For regression trees, take the average of the predicted responses.</li></ul></li>
<li class="li">Compare the out-of-bag predictions to the actual response for all observations to calculate the overall mean squared error or misclassification rate.</li></ol></dd><dd class="dd pd ddexpand">The preceding calculations increase the time that the function takes to complete.</dd><dd class="dd pd ddexpand">Default: 'false'</dd><dt class="dt pt dlterm">DisplayNumProcessedRows</dt><dd class="dd pd">[Optional] Specify whether to output the number of input rows allocated to each worker and the number of input rows processed by each worker (excluding rows skipped because they contained NULL values).</dd><dd class="dd pd ddexpand">Default: 'false'</dd><dt class="dt pt dlterm">Seed</dt><dd class="dd pd">[Optional] Specify the random seed the algorithm uses for repeatable results. The <var class="keyword varname">seed</var> must be a LONG value.<div class="note note" id="nsi1506112553032__note_N1020F_N10206_N101FF_N10018_N10014_N10010_N10001"><span><b>Note</b></span><div class="notebody"> For repeatable results, use both the Seed and UniqueID syntax elements. For more information, see <a href="qym1549987102806.md">Nondeterministic Results and UniqueID Syntax Element</a>.</div></div></dd><dt class="dt pt dlterm">IDColumn</dt><dd class="dd pd">[Required with OutOfBag, optional otherwise.] Specify the name of the InputTable column that contains the row identifier.</dd><dd class="dd pd ddexpand">Default: First InputTable column</dd></dl></div></div></div></div></body></html>
