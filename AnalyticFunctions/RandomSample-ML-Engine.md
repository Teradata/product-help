<html><head></head><body><div class="nested0" aria-labelledby="ariaid-title1" topicindex="1" topicid="vkk1507737806782" id="vkk1507737806782"><h1 class="title topictitle1" id="ariaid-title1">RandomSample (ML Engine)</h1><div class="body conbody">
<p class="p">The RandomSample function takes a data set and uses a specified sampling method to output one or more random samples. Each sample has exactly the number of rows specified.</p>
<p class="p">The RandomSample function is useful for creating test sets, training sets, and initial centers for clustering algorithms.</p>
<p class="p">In addition to the default basic sampling, in which each input table row has a probability of being selected that is proportional to its weight, this function provides two alternate methods, KMeans++ and KMeans||, which are designed for creating a set of initial seeds for the function <a href="gdl1558461123604.md#vqm1507162150338">KMeans (ML Engine)</a>.</p></div><div class="topic reference nested1" aria-labelledby="ariaid-title2" topicindex="2" topicid="nnl1507737906655" xml:lang="en-us" lang="en-us" id="nnl1507737906655">
<h2 class="title topictitle2" id="ariaid-title2">RandomSample Syntax</h2><div class="body refbody"><div class="section" id="nnl1507737906655__section_N1000E_N1000C_N10001">
<h3 class="title sectiontitle">Version <span>1.5</span></h3><pre class="pre codeblock" xml:space="preserve"><code>SELECT * FROM RandomSample (
  <span>ON { <var class="keyword varname">table</var> | <var class="keyword varname">view</var> | (<var class="keyword varname">query</var>) }</span> AS InputTable
  USING
  NumSample (<var class="keyword varname">sample_size</var> [,...])
  [ WeightColumn ('<var class="keyword varname">weight_column</var>') ]
  [ SamplingMode ({ 'basic' | 'kmeans++' | 'kmeans||' }) ]
  [ Distance ({ 'euclidean' | 'manhattan' }) ]
  [ TargetColumns ( { '<var class="keyword varname">target_column</var>' | <var class="keyword varname">target_column_range</var> }[,...] ) ]
  [ NumericAsCategorical ( { '<var class="keyword varname">ascat_column</var>' | <var class="keyword varname">ascat_column_range</var> }[,...] ) ]
  [ CategoryWeights (<var class="keyword varname">category_weight</var> [,...]) ]
  [ CategoricalDistance ({ 'overlap' | 'hamming' }) ]
  [ Seed (<var class="keyword varname">seed</var>)
    SeedColumn ({ '<var class="keyword varname">seed_column</var>' | <var class="keyword varname">seed_column_range</var> } [,...])
  ]
  [ OverSamplingRate (<var class="keyword varname">rate</var>) ]
  [ IterNum (<var class="keyword varname">number_of_iterations</var>) ]
  [ SetIDAsFirstColumn (<span><b>{'true'|'t'|'yes'|'y'|'1'|'false'|'f'|'no'|'n'|'0'}</b></span>) ]
) AS <var class="keyword varname">alias</var>;</code></pre></div></div><div class="related-links"><div class="linklistheader"><p></p><b>Related Information</b></div>
<ul class="linklist linklist relinfo"><div class="linklistmember"><a href="ndv1557782188375.md">Column Specification Syntax Elements</a></div></ul></div></div><div class="topic reference nested1" aria-labelledby="ariaid-title3" topicindex="3" topicid="xsk1507737910698" xml:lang="en-us" lang="en-us" id="xsk1507737910698">
<h2 class="title topictitle2" id="ariaid-title3">RandomSample Syntax Elements</h2><div class="body refbody"><div class="section" id="xsk1507737910698__section_N10011_N1000E_N10001"><dl class="dl parml"><dt class="dt pt dlterm">NumSample</dt><dd class="dd pd">Specify the size of each sample, an INTEGER value. If you specify <var class="keyword varname">n</var><var class="keyword varname">sample_size</var> values, the function selects <var class="keyword varname">n</var> samples. For each sample, the output table has <var class="keyword varname">sample_size</var> rows. The output column set_id identifies the sample to which each row belongs.</dd><dt class="dt pt dlterm">WeightColumn</dt><dd class="dd pd">[Optional] Specify the name of the InputTable column that contains weights for weighted sampling. The <var class="keyword varname">weight_column</var> must have a numeric SQL data type.</dd><dd class="dd pd ddexpand">Default behavior: Rows have equal weight.</dd><dt class="dt pt dlterm">SamplingMode</dt><dd class="dd pd">[Optional] Specify the sampling mode:
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="xsk1507737910698__table_nyb_svy_fdb" class="table" frame="border" border="1" rules="all"><div class="caption"></div><colgroup span="1"><col style="width:25%" span="1"></col><col style="width:75%" span="1"></col></colgroup><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:top;" id="d69558e200" rowspan="1" colspan="1">Option</th><th class="entry cellrowborder" style="vertical-align:top;" id="d69558e202" rowspan="1" colspan="1">Description</th></tr></thead><tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d69558e200" rowspan="1" colspan="1"><code class="ph codeph">'basic'</code> (Default)</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d69558e202" rowspan="1" colspan="1">Each InputTable row has a probability of being selected that is proportional to its weight. Weight of each row is in <var class="keyword varname">weight_column</var>.</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d69558e200" rowspan="1" colspan="1"><code class="ph codeph">'kmeans++'</code></td><td class="entry cellrowborder" style="vertical-align:top;" headers="d69558e202" rowspan="1" colspan="1">One row is selected in each of <var class="keyword varname">k</var> iterations, where <var class="keyword varname">k</var> is number of desired output rows. First row is selected randomly. In subsequent iterations, probability of row being selected is proportional to value in WeightColumn multiplied by distance from nearest row in set of selected rows. Distance is calculated using methods specified by Distance and CategoricalDistance syntax elements.</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d69558e200" rowspan="1" colspan="1"><code class="ph codeph">'kmeans||'</code></td><td class="entry cellrowborder" style="vertical-align:top;" headers="d69558e202" rowspan="1" colspan="1">Enhanced version of KMeans++ that exploits parallel architecture to accelerate sampling process. Algorithm is described in paper <cite class="cite">Scalable K-Means++ by Bahmani et al</cite> (<a class="xref" href="http://theory.stanford.edu/~sergei/papers/vldb12-kmpar.pdf" target="_blank" title="" shape="rect">http://theory.stanford.edu/~sergei/papers/vldb12-kmpar.pdf</a>). At each iteration, probability that a row is selected is proportional to value in WeightColumn multiplied by distance from nearest row in set of selected rows (as in KMeans++). However, KMeans|| algorithm oversamples at each iteration, significantly reducing required number of iterations; therefore, resulting set of rows might have more than <var class="keyword varname">k</var> data points. Each row in resulting set is then weighted by number of rows in table that are closer to that row than to any other selected row, and rows are clustered to produce exactly <var class="keyword varname">k</var> rows.</td></tr></tbody></table></div><div class="note tip" id="xsk1507737910698__note_N100CA_N10097_N1008A_N1003D_N10015_N10011_N1000E_N10001"><span><b>Tip</b></span><div class="notebody">For optimal performance, use <code class="ph codeph">'kmeans++'</code> when the desired sample size is less than 15 and <code class="ph codeph">'kmeans||'</code> otherwise.</div></div></dd><dt class="dt pt dlterm">Distance</dt><dd class="dd pd">[Optional] For KMeans++ and KMeans|| sampling, specify the function for computing the distance between numerical variables.</dd><dt class="dt pt dlterm">TargetColumns</dt><dd class="dd pd">[Optional] Required for KMeans++ and KMeans|| sampling.
<p class="p">Specify the names of the InputTable columns to use to calculate the distance between numerical variables.</p></dd><dt class="dt pt dlterm">NumericAsCategorical</dt><dd class="dd pd">[Optional] For KMeans++ and KMeans|| sampling, specify the names of the InputTable columns that contain numerical variables to treat as categorical variables.</dd><dd class="dd pd ddexpand">Default behavior: No numerical variables are treated as categorical variables.</dd><dt class="dt pt dlterm">CategoryWeights</dt><dd class="dd pd">[Optional] For KMeans++ and KMeans|| sampling, specify the weights (DOUBLE PRECISION values) of the categorical variables, including those that the NumericAsCategorical syntax element specifies. Specify the weights in the order (from left to right) that the variables appear in the input table. When calculating the distance between two rows, distances between categorical values are scaled by these weights.</dd><dd class="dd pd ddexpand">Default behavior: All categories have equal weight.</dd><dt class="dt pt dlterm">CategoricalDistance</dt><dd class="dd pd">[Optional] For KMeans++ and KMeans|| sampling, specify the function for computing the distance between categorical variables:
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="xsk1507737910698__table_b2y_nwy_fdb" class="table" frame="border" border="1" rules="all"><div class="caption"></div><colgroup span="1"><col style="width:50%" span="1"></col><col style="width:50%" span="1"></col></colgroup><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:top;" id="d69558e291" rowspan="1" colspan="1">Option</th><th class="entry cellrowborder" style="vertical-align:top;" id="d69558e293" rowspan="1" colspan="1">Description</th></tr></thead><tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d69558e291" rowspan="1" colspan="1"><code class="ph codeph">'overlap'</code> (Default)</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d69558e293" rowspan="1" colspan="1">Distance between two variables is 0 if they are the same, 1 if they are different.</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d69558e291" rowspan="1" colspan="1"><code class="ph codeph">'hamming'</code></td><td class="entry cellrowborder" style="vertical-align:top;" headers="d69558e293" rowspan="1" colspan="1">Distance between two variables is Hamming distance between strings that represent them. Strings must have equal length.</td></tr></tbody></table></div></dd><dt class="dt pt dlterm">Seed</dt><dd class="dd pd">[Optional] Specify the random seed the algorithm uses for repeatable results. The <var class="keyword varname">seed</var> must be a LONG value.</dd><dd class="dd pd ddexpand">If you specify Seed, you must also specify SeedColumn.<div class="note note" id="xsk1507737910698__note_N1017D_N1016E_N10167_N10018_N10014_N10010_N10001"><span><b>Note</b></span><div class="notebody"> For repeatable results, use both the Seed and UniqueID syntax elements. For more information, see <a href="qym1549987102806.md">Nondeterministic Results and UniqueID Syntax Element</a>.</div></div></dd><dt class="dt pt dlterm">SeedColumn</dt><dd class="dd pd">[Optional] Specify the names of the InputTable columns by which to partition the input. Function calls that use the same input data, <var class="keyword varname">seed</var>, and <var class="keyword varname">seed_column</var> output the same result.</dd><dd class="dd pd ddexpand">If you specify SeedColumn, you must also specify Seed.</dd><dd class="dd pd ddexpand">Ideally, the number of distinct values in the <var class="keyword varname">seed_column</var> is the same as the number of workers in the cluster. A large number of distinct values in the <var class="keyword varname">seed_column</var> degrades function performance.</dd><dt class="dt pt dlterm">OverSamplingRate</dt><dd class="dd pd">[Optional] For KMeans|| sampling, specifies the oversampling rate (a positive DOUBLE PRECISION value). The function multiplies <var class="keyword varname">rate</var> by <var class="keyword varname">sample_size</var> (for each <var class="keyword varname">sample_size</var>).</dd><dd class="dd pd ddexpand">Default: 1.0</dd><dt class="dt pt dlterm">IterNum</dt><dd class="dd pd">[Optional] For KMeans|| sampling, specify the number of iterations (a positive INTEGER value).</dd><dd class="dd pd ddexpand">Default: 5</dd><dt class="dt pt dlterm">SetIDAsFirstColumn</dt><dd class="dd pd">Specify whether the function-generated set_id column is the first output table column. If you specify 'false', set_id is the last output table column.</dd><dd class="dd pd ddexpand">Default: 'true'</dd></dl></div></div></div></div></body></html>
