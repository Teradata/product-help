## 人工膝関節置換術 - パス分析

### 始める前に

エディタを開いてこのユース ケースを進めます。
[エディタを起動する][LAUNCH EDITOR](#data={"navigateTo":"editor"})

### はじめに

このワークブックでは、Vantage Pathの機能を紹介する基本的なデモ スクリプトを提供します。対象読者はビジネス アナリストです。このデモ スクリプトは、「膝関節全置換術への行程を探る」セクションを単独で使用するか(予備的な短い初顔合わせ会合での使用など)、または他のセクションと組み合わせてより完全なデモを行えるように構成されています。

### 経験

「体験」セクションの実施所要時間は約7～10分です。

まず、<a href="/path-analyzer">Vantage Path</a> を開きます。

### セットアップ

**アセットをロード** を選択してテーブルを作成し、このユース ケースに必要なデータを自分のアカウント(Teradataデータベース インスタンス)にロードします。
[アセットをロード](#data={"id":"KneeReplacement"})

### ウォークスルー
***

#### ステップ1:膝関節全置換術への行程を探る

これから、ヘルスケアのデータを使用したVantage Path分析機能のデモを行います。具体的には、人工膝関節全置換術で最も頻繁に行われる医療処置の行程について見ていきます。

右のパネルを使って、以下のように値を設定します: 
- 「Top Paths to Show (表示する最上位のパス数)」を25のままにしておきます 
- データ ソースを選択します: 
	- イベント データベース: retail_sample_data 
	- イベント テーブル: knee_replacement

フィルタは設定せず、すべてのイベントを使用します。
イベント パターンは次のようにします: 
- イベントAでは「Any Event (任意のイベント)」のままにします 
- イベントBでは「Any Event」から「Total Knee Replacement (膝関節全置換術)」に変更します

また、最小イベント数、最大イベント数、重複を許可はデフォルトの設定のままにします。

このデモのシナリオでは、日付範囲の限定は必要ありません(ただしこのフィルタは他の状況で便利な場合があります)。

最後に、同じパスに属するイベントがどれかをパス分析に伝えるために、セッション列(entity_id)を選択する必要があります。ウェブサイト上のパスなど、一部のパス分析ではsession_idによって照合され、このシナリオではsession_idは患者(entity_id)と同じです。

クエリーに必要なすべての情報を入力したら、「Run (実行)」ボタンを選択すると、その時点でクエリが動的に生成されてVantageシステムに送信され、インターフェイスに視覚化がすぐに表示されます。

#### ステップ2:視覚化

グラフなどで表示される最初の視覚化では、膝関節全置換術への最も一般的な行程がハイライトされます。

視覚化が表示されると、いくつかのオプションが使用できるようになります。
- 関心対象の各ノードで展開したパスを手動で探索できます(膝関節鏡視下診断など、縁がオレンジ色の白丸をクリックします)。オレンジ色で塗りつぶされた丸は、このノードのフル パスが表示されていることを示します。
- すべて展開 – すべてのパスを表示します 
- すべて折り畳む – 終了イベントのみを表示します(膝関節全置換術) 
- 高優先度を選択 – 最も一般的なパスをハイライトします

-   「カウントのラベルを表示」をチェックして、個々の特定のパス セグメント(関節可動域テストから理学療法NECなど)を通過した人数を示すことができます。

-   またパスのダイアグラムとパス イベント/カウントの一覧表を切り替えることもできます。一覧表は、インターフェイスでなく直接クエリーによってこの分析を実行した場合に表示されるものです。

高優先度のパスの表示からわかるように、膝関節生検は膝関節全置換術の前の最も一般的な最後のステップです。これについてさらに深掘りし、膝関節全置換術に達していない他の行程を特定できるか確めましょう。
- まず、膝関節生検をイベントAとして選択しイベントBには「任意のイベント」を選択肢することで、膝関節生検からのパスを調べます(実行を選択します)。
- 予想通り、高優先度のパスは最終的に膝関節全置換術に辿り着きますが、他の処置も存在します。

-   Vantage Pathではパスの方向を簡単に切り替えることができるので、方向を切り替えて膝関節生検へのパスを調べましょう。  
-   ただし、「実行」を選択する前に、「終了アンカー」オプションをチェックします。このオプションにより膝関節生検が確実にパスの最後のイベントとなるので、患者は膝関節全置換術に至る行程を辿っていません。
-   この視覚化では、膝関節生検に至る最も一般的なパスを確認できます。このパス上で患者についてのさらなる分析を実施することに関心が向けられる場合もあります。

高優先度(または重要な任意のパス)を選ぶ場合、「セグメントを作成」機能を使用してさらに分析を進められるように、結果をテーブルに格納できます。

デモの「ステップ3: セグメントを作成」に進まない場合は、次のセクションをスキップして結論に進みます。

#### ステップ3:セグメントを作成

「セグメントを作成」機能をデモするために、自身のパーソナル データベースで出力テーブルがすでに作成済みである必要があります(書き込みアクセスが必要なため)。

```sql
CREATE TABLE knee_replacement_path_export(
    entity_id    varchar(100),
    path        varchar(2000)
)
```

以前デモを実施したことがありテーブルを再作成していない場合は、テーブルが空であることを確かめます。そうしないと、「セグメントを保存」で挿入されている行数が0と示されます。

パス分析では視覚的な探索が可能になり、多くの場合、関心対象のパスが特定されると、そのパス上の各人がさらなる分析の対象になります。次に「セグメントを作成」機能について見ていきましょう。

「セグメントを作成」ボタンをクリックすると、(自分が書き込みアクセスできる)データベースとテーブルを選択できます(セットアップで作成したものを使います)

この時点でいくつかのオプションがあります。
- SQLを表示 - これはVantageが実行するSQLです。このSQLをコピーしてVantage EditorやJupyterなどのクエリー ツールに貼り付け、さらに詳しく調べることができます。
- セグメントを保存 - クエリーが実行され、出力が指定のテーブルに保存されます。クエリーが実行されると、行数が表示されます。

    - クエリーを保存 – このオプションを使用すると、クエリーに名前が付けられ、SQLがVantage上のテーブルに保存されます。

    - セグメントを保存しました – 結果のテーブルを見てみましょう。Vantageエディタに切り替えます。
    - knee_replacement_path_exportテーブルからの分析情報を表示すると、列とddlステートメントに加えて 2,757のレコードがあることがわかります。
    - 単純な選択クエリを実行すると結果が表示されます。 - Entity_id と Path (選択された主要なパス)。

-   保存されたセグメントは、分析をさらに進めるための入力(例えば患者全体に何らかの共通性があるかを確めるクラスタリングなど)として使用したり、またはそれほど侵襲的な手技を使わない患者を対象とする治療計画への可能な入力として使用したりできます。

#### クリーンアップ

この例を終了したら、作成したテーブルを必ずクリーンアップしてください。

```sql
DROP TABLE knee_replacement_path_export
```

#### まとめ

この短いデモからわかるように、Vantage Analystには簡単に使用できるインターフェイスがあり、今ご覧いただいたようなパス分析の実施に有用です。パス分析では、分野横断的にさまざまなトピックが対象になります。

次のような例があります。
- 顧客の購入へのパス 
- オンラインでのカゴ落ちへのパス 
- 顧客の苦情へのパス 
- 部品故障へのパス

## データセット
***

<b>knee_replacement</b> データベースには289,839行が含まれており、各行は患者が受けた処置を表します。データベースは非正規化されているので、一部の患者情報が各行で繰り返されます。

-   `memberid`: 固有の患者識別子
-   `proccode`: 処置の識別子
-   `diagcode`: 患者の元の診断
-   `shortdesc`: 処置の短い説明
-   `amount`: 処置のコスト
-   `tstamp`: 処置の日時
-   `firstname`: 患者の名
-   `lastname`: 患者の姓
-   `email`: 患者の電子メール アドレス
-   `state`: 患者の州略号
