<html><head></head><body><div class="nested0" aria-labelledby="ariaid-title1" topicindex="1" topicid="fqy1507664712684" id="fqy1507664712684"><h1 class="title topictitle1" id="ariaid-title1">Canopy (ML Engine)</h1><div class="body conbody">
<p class="p">Canopy clustering is a simple, fast, accurate method for grouping objects into preliminary clusters.  It is often performed in preparation for more rigorous clustering techniques, such as <var class="keyword varname">k</var>-means clustering.</p>
<p class="p">The canopy clustering algorithm uses a fast approximate distance metric and two distance thresholds, T<span><sub>1</sub></span> (loose distance) and T<span><sub>2</sub></span> (tight distance), with T<span><sub>1</sub></span> greater than T<span><sub>2</sub></span>. A point is assigned to a canopy if the distance from the point to the canopy center is less than T<span><sub>2</sub></span>, and can be assigned to a canopy if the distance from the point to the canopy center is less than T<span><sub>1</sub></span>. A point can be assigned to more than one canopy.</p>
<p class="p">For distance measurement, the Canopy function uses Euclidean distance.</p>
<p class="p">If there are more than 10,000 canopy centers, the function fails. Run the function again, increasing the value of T<span><sub>2</sub></span> (specified by the TightDistance syntax element).</p></div><div class="topic reference nested1" aria-labelledby="ariaid-title2" topicindex="2" topicid="vtv1507664783941" xml:lang="en-us" lang="en-us" id="vtv1507664783941">
<h2 class="title topictitle2" id="ariaid-title2">Canopy Syntax</h2><div class="body refbody"><div class="section" id="vtv1507664783941__section_N1000E_N1000C_N10001">
<h3 class="title sectiontitle">Version </h3><pre class="pre codeblock" xml:space="preserve"><code>SELECT * FROM Canopy (
  <span>ON { <var class="keyword varname">table</var> | <var class="keyword varname">view</var> | (<var class="keyword varname">query</var>) }</span> AS InputTable
  USING
  
  LooseDistance (<var class="keyword varname">maximum</var>)
  TightDistance (<var class="keyword varname">minimum</var>)
) AS <var class="keyword varname">alias</var>;</code></pre></div></div></div><div class="topic reference nested1" aria-labelledby="ariaid-title3" topicindex="3" topicid="xro1507664904827" xml:lang="en-us" lang="en-us" id="xro1507664904827">
<h2 class="title topictitle2" id="ariaid-title3">Canopy Syntax Elements</h2><div class="body refbody"><div class="section" id="xro1507664904827__section_N10011_N1000E_N10001"><dl class="dl parml"><dt class="dt pt dlterm">LooseDistance</dt><dd class="dd pd">Specify the maximum distance that any point can be from a canopy center to be considered part of that canopy (T<span><sub>1</sub></span>).</dd><dt class="dt pt dlterm">TightDistance</dt><dd class="dd pd">Specify the minimum distance that separates two canopy centers (T<span><sub>2</sub></span>).</dd></dl></div></div></div><div class="topic reference nested1" aria-labelledby="ariaid-title4" topicindex="4" topicid="ciy1507664952328" xml:lang="en-us" lang="en-us" id="ciy1507664952328">
<h2 class="title topictitle2" id="ariaid-title4">Canopy Input</h2><div class="body refbody"><div class="section" id="ciy1507664952328__section_N1000E_N1000C_N10001">
<h3 class="title sectiontitle">InputTable Schema</h3><div class="note note" id="ciy1507664952328__note_N10068_N10024_N10001"><span><b>Note</b></span><div class="notebody">It is important to normalize the input variables before calling this function. For details, see <a href="qnw1570800778984.md">Normalized Input</a>.</div></div>
<p class="p">The table can have only the columns described in the following table.</p><div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="ciy1507664952328__table_N10014_N1000E_N1000C_N10001" class="table" frame="border" border="1" rules="all"><div class="caption"></div><colgroup span="1"><col style="width:16.666666666666664%" span="1"></col><col style="width:16.666666666666664%" span="1"></col><col style="width:66.66666666666666%" span="1"></col></colgroup><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry nocellnorowborder" style="vertical-align:top;" id="d406792e175" rowspan="1" colspan="1">Column</th><th class="entry nocellnorowborder" style="vertical-align:top;" id="d406792e177" rowspan="1" colspan="1">Data Type</th><th class="entry cell-norowborder" style="vertical-align:top;" id="d406792e179" rowspan="1" colspan="1">Description</th></tr></thead><tbody class="tbody"><tr class="row"><td class="entry nocellnorowborder" style="vertical-align:top;" headers="d406792e175" rowspan="1" colspan="1"><var class="keyword varname">id</var></td><td class="entry nocellnorowborder" style="vertical-align:top;" headers="d406792e177" rowspan="1" colspan="1">Any</td><td class="entry cell-norowborder" style="vertical-align:top;" headers="d406792e179" rowspan="1" colspan="1">Row identifier.</td></tr><tr class="row"><td class="entry row-nocellborder" style="vertical-align:top;" headers="d406792e175" rowspan="1" colspan="1"><var class="keyword varname">dimension_i</var></td><td class="entry row-nocellborder" style="vertical-align:top;" headers="d406792e177" rowspan="1" colspan="1">DOUBLE PRECISION</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e179" rowspan="1" colspan="1">[Column appears once for each dimension.] Data in dimension <var class="keyword varname">i</var>.</td></tr></tbody></table></div></div></div></div><div class="topic reference nested1" aria-labelledby="ariaid-title5" topicindex="5" topicid="nyk1507665004944" xml:lang="en-us" lang="en-us" id="nyk1507665004944">
<h2 class="title topictitle2" id="ariaid-title5">Canopy Output</h2><div class="body refbody"><div class="section" id="nyk1507665004944__section_N1000E_N1000C_N10001">
<h3 class="title sectiontitle">Output Table Schema</h3><div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="nyk1507665004944__table_N10014_N1000E_N1000C_N10001" class="table" frame="border" border="1" rules="all"><div class="caption"></div><colgroup span="1"><col style="width:18.51851851851852%" span="1"></col><col style="width:14.814814814814813%" span="1"></col><col style="width:66.66666666666666%" span="1"></col></colgroup><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry nocellnorowborder" style="vertical-align:top;" id="d406792e220" rowspan="1" colspan="1">Column</th><th class="entry nocellnorowborder" style="vertical-align:top;" id="d406792e222" rowspan="1" colspan="1">Data Type</th><th class="entry cell-norowborder" style="vertical-align:top;" id="d406792e224" rowspan="1" colspan="1">Description</th></tr></thead><tbody class="tbody"><tr class="row"><td class="entry nocellnorowborder" style="vertical-align:top;" headers="d406792e220" rowspan="1" colspan="1">canopyid</td><td class="entry nocellnorowborder" style="vertical-align:top;" headers="d406792e222" rowspan="1" colspan="1">INTEGER</td><td class="entry cell-norowborder" style="vertical-align:top;" headers="d406792e224" rowspan="1" colspan="1">Canopy identifier.</td></tr><tr class="row"><td class="entry row-nocellborder" style="vertical-align:top;" headers="d406792e220" rowspan="1" colspan="1"><var class="keyword varname">dimension_i</var></td><td class="entry row-nocellborder" style="vertical-align:top;" headers="d406792e222" rowspan="1" colspan="1">DOUBLE PRECISION</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e224" rowspan="1" colspan="1">[Column appears once for each dimension.] Canopy center for dimension <var class="keyword varname">i</var>.</td></tr></tbody></table></div></div></div></div><div class="topic reference nested1" aria-labelledby="ariaid-title6" topicindex="6" topicid="pyq1510703406272" xml:lang="en-us" lang="en-us" id="pyq1510703406272">
<h2 class="title topictitle2" id="ariaid-title6">Canopy Example</h2><div class="body refbody"><div class="section" id="pyq1510703406272__section_rlc_j5k_rdb">
<h3 class="title sectiontitle">Input</h3>
<p class="p">The input table has more than 6000 rows of computer specifications.</p><div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="pyq1510703406272__table_nvz_v5k_rdb" class="table" frame="border" border="1" rules="all"><div class="caption"><span>InputTable: computers_train1</span></div><colgroup span="1"><col style="width:16.666666666666664%" span="1"></col><col style="width:16.666666666666664%" span="1"></col><col style="width:16.666666666666664%" span="1"></col><col style="width:16.666666666666664%" span="1"></col><col style="width:16.666666666666664%" span="1"></col><col style="width:16.666666666666664%" span="1"></col></colgroup><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:top;" id="d406792e282" rowspan="1" colspan="1">id</th><th class="entry cellrowborder" style="vertical-align:top;" id="d406792e284" rowspan="1" colspan="1">price</th><th class="entry cellrowborder" style="vertical-align:top;" id="d406792e286" rowspan="1" colspan="1">speed</th><th class="entry cellrowborder" style="vertical-align:top;" id="d406792e288" rowspan="1" colspan="1">hd</th><th class="entry cellrowborder" style="vertical-align:top;" id="d406792e290" rowspan="1" colspan="1">ram</th><th class="entry cellrowborder" style="vertical-align:top;" id="d406792e292" rowspan="1" colspan="1">screen</th></tr></thead><tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">1</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">1499</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">25</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">80</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">4</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">2</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">1795</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">33</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">85</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">2</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">3</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">1595</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">25</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">170</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">4</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">15</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">4</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">1849</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">25</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">170</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">8</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">5</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">3295</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">33</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">340</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">16</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">6</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">3695</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">66</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">340</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">16</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">7</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">1720</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">25</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">170</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">4</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">8</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">1995</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">50</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">85</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">2</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">9</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">2225</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">50</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">210</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">2</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">12</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">2605</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">66</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">210</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">8</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">13</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">2045</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">50</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">130</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">4</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">14</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">2295</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">25</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">245</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">8</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">16</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">2225</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">50</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">130</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">4</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">17</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">1595</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">33</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">85</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">2</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">18</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">2325</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">33</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">210</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">4</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">15</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">19</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">2095</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">33</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">250</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">4</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">15</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">20</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">4395</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">66</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">452</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">8</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">14</td></tr><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e282" rowspan="1" colspan="1">...</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e284" rowspan="1" colspan="1">...</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e286" rowspan="1" colspan="1">...</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e288" rowspan="1" colspan="1">...</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e290" rowspan="1" colspan="1">...</td><td class="entry cellrowborder" style="vertical-align:top;" headers="d406792e292" rowspan="1" colspan="1">...</td></tr></tbody></table></div></div><div class="section" id="pyq1510703406272__section_w5m_j5k_rdb">
<h3 class="title sectiontitle">SQL Call</h3><pre class="pre codeblock" xml:space="preserve"><code>SELECT * FROM Canopy(
  ON computers_train1 AS InputTable
  USING
  LooseDistance(1000)
  TightDistance(500)
) AS dt;</code></pre></div><div class="section" id="pyq1510703406272__section_bhz_j5k_rdb">
<h3 class="title sectiontitle">Output</h3><pre class="pre screen" xml:space="preserve"> canopyid price            speed            hd               ram              screen           
 -------- ---------------- ---------------- ---------------- ---------------- ---------------- 
        1 3669.84615384615 57.2307692307692 363.153846153846 8.61538461538461 14.5384615384615
        2 1893.51282051282 34.6153846153846  156.25641025641 4.46153846153846 14.0769230769231
        3 2585.75471698113 45.4528301886792 227.320754716981 6.86792452830189 14.4339622641509</pre>
<p class="p">Download a zip file of all examples and a SQL script file that creates their input tables from the attachment in the left sidebar.</p></div></div></div></div></body></html>
