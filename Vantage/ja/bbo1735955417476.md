外部サーバーを作成するには、開始 (ソース) システムとターゲット (外部) システムの両方でSQLステートメントを実行し、権限を付与してリソースを作成します。すべてのSQLステートメントは、外部サーバー作成のために自動的に実行されます。実行される各SQLステートメントのステータス値は次のとおりです。

-   **成功**

    SQLステートメントが正常に実行されました。


-   **失敗**

     SQLステートメントの実行に失敗しました。これはエラーで示されます。


-   **スキップ**

    SQLステートメントを実行する必要がありませんでした。または、SQLステートメントの1つが失敗したため、残りのステートメントが実行されませんでした。


## 実行ステージ


外部サーバーの作成ステージです。

ソース システムでのアクションは次のとおりです。

-   必要なリソースの作成または必要な機能へのアクセスに要する権限を付与します。


-   認証オブジェクトや外部サーバーなどのリソースを作成します。


ターゲット システムでのアクションは次のとおりです。

-   サービス アカウント ユーザーを作成します。


-   許可されたユーザーに **connect-through** 権限を付与します (権限がまだ存在しない場合)。


外部サーバーの作成中にSQLステートメントが失敗した場合、残りのSQLステートメントはスキップされ、外部サーバーの作成は停止されます。この場合、**ロールバック** ステージがトリガされ (サポートされている場合)、開始システムとターゲット システムの両方でアクションがクリーンアップされます。ロールバックされるのは **実行** ステージで完了したSQLステートメントのみです。

失敗したステートメントのエラー メッセージが表示されるので、これを参考にして問題を修正します。残りのステートメントにはステータス **スキップ** が表示されます。リストされている問題を修正したら、**外部サーバーの作成** を再実行します。

## ロールバック ステージ


外部サーバーの作成中に **実行** ステージが失敗した場合、**ロールバック** ステージが自動的に実行され、環境が元の状態に復元されます。**ロールバック** ステージは、開始コネクタとターゲット コネクタの両方にQueryGrid 3.07以降がインストールされている場合にサポートされます。

開始システムおよびターゲット システムでのアクション:

-   実行ステージで付与されたアクセス権限の取り消し


-   実行ステージで作成されたオブジェクト (認証、外部サーバー、サービス アカウント ユーザーなど) の削除


ロールバック中にSQLステートメントが失敗した場合、残りのSQLステートメントはすべてスキップされ、外部サーバーのロールバックは停止します。失敗したステートメントのエラー メッセージが表示されるので、これを参考にして環境を以前の状態に復元します。失敗したSQLステートメントのエラーを修正したら、修正したステートメントとすべての **スキップ** ステートメントを手動で再実行します。

ロールバック中に失敗が発生した場合は、作成に関する問題を修正する前に、ロールバックに関する問題を修正してください。

